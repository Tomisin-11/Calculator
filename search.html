<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TCal - Search Mode</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect fill='%23000' width='100' height='100'/><text y='70' x='50' text-anchor='middle' font-size='45' font-weight='900' fill='%23fff'>TC</text></svg>">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #000000;
            color: #ffffff;
            min-height: 100vh;
        }

        /* Navbar */
        .navbar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 70px;
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 40px;
            z-index: 1000;
        }

        .logo {
            font-size: 32px;
            font-weight: 800;
            background: linear-gradient(135deg, #ffffff 0%, #888888 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -2px;
            cursor: pointer;
            transition: transform 0.3s;
        }

        .logo:hover {
            transform: scale(1.05);
        }

        .nav-links {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .nav-link {
            color: #888888;
            text-decoration: none;
            font-weight: 600;
            font-size: 14px;
            padding: 10px 20px;
            border-radius: 8px;
            transition: all 0.3s;
        }

        .nav-link:hover {
            color: #ffffff;
            background: rgba(255, 255, 255, 0.1);
        }

        /* Hamburger Menu */
        .hamburger {
            display: none;
            flex-direction: column;
            gap: 5px;
            cursor: pointer;
            padding: 10px;
        }

        .hamburger span {
            width: 25px;
            height: 3px;
            background: #ffffff;
            border-radius: 2px;
            transition: all 0.3s;
        }

        .hamburger.active span:nth-child(1) {
            transform: rotate(45deg) translate(8px, 8px);
        }

        .hamburger.active span:nth-child(2) {
            opacity: 0;
        }

        .hamburger.active span:nth-child(3) {
            transform: rotate(-45deg) translate(7px, -7px);
        }

        .mobile-menu {
            display: none;
            position: fixed;
            top: 70px;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.98);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding: 20px;
            flex-direction: column;
            gap: 10px;
            z-index: 999;
        }

        .mobile-menu.active {
            display: flex;
        }

        .mobile-menu .nav-link {
            width: 100%;
            text-align: center;
            padding: 15px;
        }

        /* Main Container */
        .container {
            margin-top: 70px;
            padding: 40px 20px;
            max-width: 1200px;
            margin-left: auto;
            margin-right: auto;
        }

        /* Header */
        .page-header {
            text-align: center;
            margin-bottom: 40px;
            animation: fadeInDown 0.6s cubic-bezier(0.16, 1, 0.3, 1);
        }

        .page-header h1 {
            font-size: 48px;
            font-weight: 900;
            margin-bottom: 12px;
            letter-spacing: -2px;
            background: linear-gradient(135deg, #ffffff 0%, #888888 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .page-header p {
            color: #888888;
            font-size: 18px;
        }

        /* Subject Selector */
        .subject-selector {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            justify-content: center;
            margin-bottom: 40px;
            animation: fadeInDown 0.6s cubic-bezier(0.16, 1, 0.3, 1) 0.1s backwards;
        }

        .subject-chip {
            padding: 10px 24px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 100px;
            color: #888888;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
            font-weight: 600;
        }

        .subject-chip:hover {
            border-color: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .subject-chip.active {
            background: #ffffff;
            color: #000000;
            border-color: #ffffff;
        }

        /* Search Area */
        .search-area {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 24px;
            padding: 40px;
            margin-bottom: 30px;
            animation: fadeInUp 0.6s cubic-bezier(0.16, 1, 0.3, 1) 0.2s backwards;
        }

        /* Image Upload Section */
        .image-upload-section {
            margin-bottom: 20px;
        }

        .upload-buttons {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            margin-bottom: 16px;
        }

        .upload-btn {
            flex: 1;
            min-width: 140px;
            padding: 12px 20px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            color: #ffffff;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .upload-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .image-preview {
            margin-top: 16px;
            position: relative;
            display: none;
        }

        .image-preview.show {
            display: block;
        }

        .image-preview img {
            width: 100%;
            max-height: 300px;
            object-fit: contain;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .remove-image {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(255, 100, 100, 0.9);
            color: white;
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .remove-image:hover {
            background: rgba(255, 50, 50, 1);
            transform: scale(1.1);
        }

        .search-input {
            width: 100%;
            min-height: 200px;
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 24px;
            color: #ffffff;
            font-size: 16px;
            font-family: inherit;
            resize: vertical;
            transition: all 0.3s;
            line-height: 1.6;
        }

        .search-input:focus {
            outline: none;
            border-color: rgba(255, 255, 255, 0.3);
            background: rgba(0, 0, 0, 0.7);
        }

        .search-input::placeholder {
            color: #555555;
        }

        .action-buttons {
            display: flex;
            gap: 12px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .action-btn {
            flex: 1;
            min-width: 150px;
            padding: 16px 24px;
            background: rgba(255, 255, 255, 0.05);
            color: #ffffff;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .action-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .action-btn.primary {
            background: #ffffff;
            color: #000000;
            border-color: #ffffff;
        }

        .action-btn.primary:hover {
            background: #eeeeee;
        }

        /* Results Area */
        .results-area {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 24px;
            padding: 40px;
            min-height: 300px;
            animation: fadeInUp 0.6s cubic-bezier(0.16, 1, 0.3, 1) 0.3s backwards;
        }

        .results-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 24px;
        }

        .results-content {
            color: #cccccc;
            line-height: 1.8;
            font-size: 15px;
        }

        .results-placeholder {
            color: #555555;
            text-align: center;
            padding: 80px 20px;
            font-size: 16px;
        }

        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            color: #888888;
            padding: 80px 20px;
        }

        .spinner {
            width: 24px;
            height: 24px;
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-top-color: #ffffff;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* View Answer Button */
        .view-answer-btn {
            display: none;
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #ffffff;
            color: #000000;
            padding: 16px 24px;
            border-radius: 50px;
            font-weight: 700;
            font-size: 14px;
            box-shadow: 0 10px 40px rgba(255, 255, 255, 0.3);
            cursor: pointer;
            z-index: 100;
            animation: bounceIn 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            align-items: center;
            gap: 8px;
            border: none;
        }

        .view-answer-btn.show {
            display: flex;
        }

        @keyframes bounceIn {
            0% {
                transform: scale(0);
                opacity: 0;
            }
            50% {
                transform: scale(1.1);
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        .view-answer-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 15px 50px rgba(255, 255, 255, 0.4);
        }

        .arrow-down {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-bottom: 3px solid #000000;
            border-right: 3px solid #000000;
            transform: rotate(45deg);
            animation: arrowBounce 1.5s infinite;
        }

        @keyframes arrowBounce {
            0%, 100% {
                transform: rotate(45deg) translateY(0);
            }
            50% {
                transform: rotate(45deg) translateY(5px);
            }
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Quick Examples */
        .quick-examples {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 16px;
            margin-bottom: 30px;
        }

        .example-card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 16px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .example-card:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .example-title {
            font-size: 13px;
            font-weight: 600;
            color: #888888;
            margin-bottom: 6px;
        }

        .example-text {
            font-size: 14px;
            color: #cccccc;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .navbar {
                padding: 0 20px;
            }

            .nav-links {
                display: none;
            }

            .hamburger {
                display: flex;
            }

            .page-header h1 {
                font-size: 36px;
            }

            .search-area, .results-area {
                padding: 24px;
            }

            .action-buttons {
                flex-direction: column;
            }

            .action-btn {
                width: 100%;
            }

            .subject-chip {
                padding: 8px 16px;
                font-size: 12px;
            }

            .upload-buttons {
                flex-direction: column;
            }

            .upload-btn {
                width: 100%;
            }

            .view-answer-btn.show {
                display: flex !important;
            }
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar">
        <div class="logo" onclick="window.location.href='index.html'">TCal</div>
        <div class="nav-links">
            <a href="index.html" class="nav-link">Home</a>
            <a href="calculator.html" class="nav-link">Calculator</a>
        </div>
        <div class="hamburger" onclick="toggleMobileMenu()">
            <span></span>
            <span></span>
            <span></span>
        </div>
    </nav>

    <!-- Mobile Menu -->
    <div class="mobile-menu" id="mobileMenu">
        <a href="index.html" class="nav-link">Home</a>
        <a href="calculator.html" class="nav-link">Calculator</a>
    </div>

    <!-- Main Container -->
    <div class="container">
        <!-- Header -->
        <div class="page-header">
            <h1>AI Search</h1>
            <p>Ask any question and get detailed explanations</p>
        </div>

        <!-- Subject Selector -->
        <div class="subject-selector">
            <div class="subject-chip active" onclick="selectSubject('Mathematics')">Mathematics</div>
            <div class="subject-chip" onclick="selectSubject('Physics')">Physics</div>
            <div class="subject-chip" onclick="selectSubject('Chemistry')">Chemistry</div>
            <div class="subject-chip" onclick="selectSubject('Statistics')">Statistics</div>
            <div class="subject-chip" onclick="selectSubject('Engineering')">Engineering</div>
            <div class="subject-chip" onclick="selectSubject('Biology')">Biology</div>
        </div>

        <!-- Quick Examples -->
        <div class="quick-examples">
            <div class="example-card" onclick="useExample('Solve: x¬≤ - 5x + 6 = 0')">
                <div class="example-title">Algebra</div>
                <div class="example-text">Solve quadratic equations</div>
            </div>
            <div class="example-card" onclick="useExample('A ball is thrown upward at 20 m/s. Find max height (g = 9.8 m/s¬≤)')">
                <div class="example-title">Physics</div>
                <div class="example-text">Kinematics problems</div>
            </div>
            <div class="example-card" onclick="useExample('Balance: Fe + O‚ÇÇ ‚Üí Fe‚ÇÇO‚ÇÉ')">
                <div class="example-title">Chemistry</div>
                <div class="example-text">Balance chemical equations</div>
            </div>
            <div class="example-card" onclick="useExample('Calculate the derivative of f(x) = x¬≥ + 2x¬≤ - 5x + 3')">
                <div class="example-title">Calculus</div>
                <div class="example-text">Find derivatives</div>
            </div>
        </div>

        <!-- Search Area -->
        <div class="search-area">
            <!-- Image Upload Section -->
            <div class="image-upload-section">
                <div class="upload-buttons">
                    <label class="upload-btn">
                        üìÅ Upload Image
                        <input type="file" id="imageUpload" accept="image/*" style="display: none;" onchange="handleImageUpload(event)">
                    </label>
                    <button class="upload-btn" onclick="openCamera()">üì∑ Take Photo</button>
                </div>
                <div class="image-preview" id="imagePreview">
                    <img id="previewImg" src="" alt="Preview">
                    <button class="remove-image" onclick="removeImage()">√ó</button>
                </div>
            </div>

            <textarea 
                id="searchInput" 
                class="search-input" 
                placeholder="Type your question here...

Examples:
‚Ä¢ Solve: 2x + 5 = 15
‚Ä¢ What is the quadratic formula and how do I use it?
‚Ä¢ Explain Newton's second law with examples
‚Ä¢ How do I calculate standard deviation?

Press Ctrl+Enter to search"></textarea>

            <div class="action-buttons">
                <button class="action-btn primary" onclick="performSearch()">
                    <span>ü§ñ</span>
                    Get Answer
                </button>
                <button class="action-btn" onclick="clearSearch()">
                    <span>üóëÔ∏è</span>
                    Clear
                </button>
                <button class="action-btn" onclick="savePDF()">
                    <span>üíæ</span>
                    Save PDF
                </button>
            </div>
        </div>

        <!-- Results Area -->
        <div class="results-area" id="resultsArea">
            <div class="results-title">AI Answer</div>
            <div id="resultsContent" class="results-placeholder">
                Enter your question above or upload/take a photo to see the AI-powered response
            </div>
        </div>
    </div>

    <!-- View Answer Button (Mobile/Desktop) -->
    <button class="view-answer-btn" id="viewAnswerBtn" onclick="scrollToAnswer()">
        View Answer
        <span class="arrow-down"></span>
    </button>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script>
        const apiKey = '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';
        let currentSubject = 'Mathematics';
        let uploadedImage = null;

        function toggleMobileMenu() {
            const menu = document.getElementById('mobileMenu');
            const hamburger = document.querySelector('.hamburger');
            menu.classList.toggle('active');
            hamburger.classList.toggle('active');
        }

        function selectSubject(subject) {
            currentSubject = subject;
            document.querySelectorAll('.subject-chip').forEach(chip => chip.classList.remove('active'));
            event.target.classList.add('active');
        }

        function useExample(text) {
            document.getElementById('searchInput').value = text;
            document.getElementById('searchInput').focus();
        }

        // Image Upload Functions
        function handleImageUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    uploadedImage = e.target.result;
                    document.getElementById('previewImg').src = uploadedImage;
                    document.getElementById('imagePreview').classList.add('show');
                };
                reader.readAsDataURL(file);
            }
        }

        function openCamera() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';
            input.capture = 'environment';
            input.onchange = handleImageUpload;
            input.click();
        }

        function removeImage() {
            uploadedImage = null;
            document.getElementById('imagePreview').classList.remove('show');
            document.getElementById('imageUpload').value = '';
        }

        function clearSearch() {
            document.getElementById('searchInput').value = '';
            removeImage();
            document.getElementById('resultsContent').innerHTML = `
                <div class="results-placeholder">
                    Enter your question above or upload/take a photo to see the AI-powered response
                </div>
            `;
            hideViewAnswerBtn();
        }

        async function performSearch() {
            const query = document.getElementById('searchInput').value;
            
            if (!query.trim() && !uploadedImage) {
                alert('Please enter a question or upload an image!');
                return;
            }

            const resultsContent = document.getElementById('resultsContent');
            
            resultsContent.innerHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    <span>AI is thinking...</span>
                </div>
            `;

            showViewAnswerBtn();

            try {
                let messages = [];

                if (uploadedImage) {
                    // Vision API call
                    messages = [{
                        role: "user",
                        content: [
                            {
                                type: "text",
                                text: query || `You are a ${currentSubject} tutor. Analyze this image and provide a detailed explanation. If it contains a problem, solve it step-by-step. If it's a diagram or graph, explain what it shows.`
                            },
                            {
                                type: "image_url",
                                image_url: {
                                    url: uploadedImage
                                }
                            }
                        ]
                    }];

                    const response = await fetch("https://api.groq.com/openai/v1/chat/completions", {
                        method: "POST",
                        headers: { 
                            "Content-Type": "application/json",
                            "Authorization": `Bearer ${apiKey}`
                        },
                        body: JSON.stringify({
                            model: "llama-3.2-90b-vision-preview",
                            messages: messages,
                            temperature: 0.7,
                            max_tokens: 3000
                        })
                    });

                    const data = await response.json();
                    
                    if (data.error) {
                        throw new Error(data.error.message);
                    }
                    
                    const answer = data.choices[0].message.content;
                    resultsContent.innerHTML = `
                        <div class="results-content">
                            ${answer.replace(/\n/g, '<br>')}
                        </div>
                    `;
                } else {
                    // Text-only API call
                    const response = await fetch("https://api.groq.com/openai/v1/chat/completions", {
                        method: "POST",
                        headers: { 
                            "Content-Type": "application/json",
                            "Authorization": `Bearer ${apiKey}`
                        },
                        body: JSON.stringify({
                            model: "llama-3.3-70b-versatile",
                            messages: [{
                                role: "user",
                                content: `You are an expert ${currentSubject} tutor. Answer this question with detailed step-by-step explanations:\n\n${query}\n\nProvide a comprehensive, educational response.`
                            }],
                            temperature: 0.7,
                            max_tokens: 3000
                        })
                    });

                    const data = await response.json();
                    
                    if (data.error) {
                        throw new Error(data.error.message);
                    }
                    
                    const answer = data.choices[0].message.content;
                    resultsContent.innerHTML = `
                        <div class="results-content">
                            ${answer.replace(/\n/g, '<br>')}
                        </div>
                    `;
                }
                
            } catch (error) {
                resultsContent.innerHTML = `
                    <p style="color: #ff6666;">Error: ${error.message}</p>
                `;
            }
        }

        function savePDF() {
            const resultsContent = document.getElementById('resultsContent');
            
            if (resultsContent.querySelector('.results-placeholder') || resultsContent.querySelector('.loading')) {
                alert('Please get an answer first!');
                return;
            }

            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            const question = document.getElementById('searchInput').value;
            const answer = resultsContent.innerText;
            
            doc.setFontSize(18);
            doc.setFont(undefined, 'bold');
            doc.text('TCal AI Search Results', 15, 20);
            
            doc.setFontSize(10);
            doc.setFont(undefined, 'normal');
            doc.text(`Subject: ${currentSubject}`, 15, 30);
            doc.text(`Date: ${new Date().toLocaleString()}`, 15, 37);
            
            doc.setDrawColor(200, 200, 200);
            doc.line(15, 42, 195, 42);
            
            if (question) {
                doc.setFontSize(12);
                doc.setFont(undefined, 'bold');
                doc.text('Question:', 15, 52);
                doc.setFont(undefined, 'normal');
                doc.setFontSize(11);
                const questionLines = doc.splitTextToSize(question, 180);
                doc.text(questionLines, 15, 60);
                
                var yPosition = 60 + (questionLines.length * 7) + 10;
            } else {
                var yPosition = 52;
            }
            
            doc.setFontSize(12);
            doc.setFont(undefined, 'bold');
            doc.text('Answer:', 15, yPosition);
            doc.setFont(undefined, 'normal');
            doc.setFontSize(11);
            yPosition += 8;
            
            const answerLines = doc.splitTextToSize(answer, 180);
            doc.text(answerLines, 15, yPosition);
            
            doc.save(`TCal-${currentSubject}-${Date.now()}.pdf`);
        }

        function scrollToAnswer() {
            const resultsArea = document.getElementById('resultsArea');
            resultsArea.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        function showViewAnswerBtn() {
            document.getElementById('viewAnswerBtn').classList.add('show');
        }

        function hideViewAnswerBtn() {
            document.getElementById('viewAnswerBtn').classList.remove('show');
        }

        // Keyboard shortcuts
        document.getElementById('searchInput').addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && e.ctrlKey) {
                performSearch();
            }
        });

        // Close mobile menu when clicking outside
        document.addEventListener('click', (e) => {
            const menu = document.getElementById('mobileMenu');
            const hamburger = document.querySelector('.hamburger');
            if (menu.classList.contains('active') && !menu.contains(e.target) && !hamburger.contains(e.target)) {
                menu.classList.remove('active');
                hamburger.classList.remove('active');
            }
        });
    </script>
</body>
</html>
