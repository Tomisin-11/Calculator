<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TCal - Study Mode</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect fill='%23000' width='100' height='100'/><text y='70' x='50' text-anchor='middle' font-size='45' font-weight='900' fill='%23fff'>TC</text></svg>">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #000; color: #fff; min-height: 100vh; }
        .navbar { position: fixed; top: 0; left: 0; right: 0; height: 70px; background: rgba(0,0,0,0.95); backdrop-filter: blur(20px); border-bottom: 1px solid rgba(255,255,255,0.1); display: flex; align-items: center; justify-content: space-between; padding: 0 40px; z-index: 1000; }
        .logo { font-size: 32px; font-weight: 800; background: linear-gradient(135deg, #fff 0%, #888 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; letter-spacing: -2px; cursor: pointer; }
        .nav-links { display: flex; gap: 20px; }
        .nav-link { color: #888; text-decoration: none; font-weight: 600; font-size: 14px; padding: 10px 20px; border-radius: 8px; transition: all 0.3s; }
        .nav-link:hover { color: #fff; background: rgba(255,255,255,0.1); }
        .container { margin-top: 100px; padding: 40px 20px; max-width: 1200px; margin-left: auto; margin-right: auto; }
        .mode-btns { display: flex; gap: 12px; margin-bottom: 30px; flex-wrap: wrap; }
        .mode-btn { flex: 1; min-width: 140px; padding: 12px 20px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; color: #888; cursor: pointer; font-weight: 600; transition: all 0.3s; }
        .mode-btn:hover { background: rgba(255,255,255,0.08); }
        .mode-btn.calc { background: rgba(0,255,136,0.15); border-color: rgba(0,255,136,0.3); color: #00ff88; }
        .mode-btn.search { background: rgba(0,255,136,0.15); border-color: rgba(0,255,136,0.3); color: #00ff88; }
        .step { display: none; }
        .step.active { display: block; animation: fadeIn 0.4s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-top: 30px; }
        .card { background: rgba(255,255,255,0.05); border: 2px solid rgba(255,255,255,0.1); border-radius: 16px; padding: 24px; cursor: pointer; text-align: center; transition: all 0.3s; }
        .card:hover { background: rgba(255,255,255,0.08); border-color: rgba(255,136,0,0.5); transform: translateY(-4px); }
        .btn { padding: 14px 28px; background: linear-gradient(135deg, #6366f1, #8b5cf6); color: #fff; border: none; border-radius: 12px; font-size: 15px; font-weight: 700; cursor: pointer; transition: all 0.3s; margin-top: 20px; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 12px 32px rgba(99,102,241,0.5); }
        .back-btn { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.2); padding: 10px 20px; border-radius: 8px; cursor: pointer; margin-bottom: 20px; display: inline-block; }
        .back-btn:hover { background: rgba(255,255,255,0.08); }
        .quiz-question { background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.1); border-radius: 20px; padding: 30px; margin-bottom: 20px; }
        .quiz-option { background: rgba(255,255,255,0.05); border: 2px solid rgba(255,255,255,0.1); border-radius: 12px; padding: 16px; margin: 12px 0; cursor: pointer; transition: all 0.3s; }
        .quiz-option:hover { background: rgba(255,255,255,0.08); }
        .quiz-option.selected { border-color: #6366f1; background: rgba(99,102,241,0.1); }
        .quiz-option.correct { border-color: #00ff88; background: rgba(0,255,136,0.1); }
        .quiz-option.wrong { border-color: #ff6666; background: rgba(255,100,100,0.1); }
        .timer { position: fixed; top: 100px; right: 40px; background: rgba(0,0,0,0.9); padding: 20px; border-radius: 12px; font-size: 24px; font-weight: 700; border: 2px solid rgba(255,136,0,0.5); }
        .progress { background: rgba(255,255,255,0.1); height: 8px; border-radius: 4px; margin: 20px 0; overflow: hidden; }
        .progress-fill { background: linear-gradient(90deg, #6366f1, #00ff88); height: 100%; transition: width 0.3s; }
        .score-card { background: linear-gradient(135deg, rgba(99,102,241,0.2), rgba(139,92,246,0.2)); border: 2px solid rgba(99,102,241,0.5); border-radius: 20px; padding: 40px; text-align: center; margin: 30px 0; }
        .score-card h2 { font-size: 48px; margin-bottom: 16px; }
        textarea { width: 100%; padding: 18px; background: rgba(0,0,0,0.5); border: 1px solid rgba(255,255,255,0.1); border-radius: 16px; color: #fff; font-size: 15px; font-family: inherit; min-height: 120px; resize: vertical; }
        textarea:focus { outline: none; border-color: rgba(255,136,0,0.5); }
        select { padding: 12px; background: rgba(0,0,0,0.5); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; color: #fff; font-size: 14px; cursor: pointer; width: 100%; margin: 10px 0; }
        .roadmap { background: rgba(255,255,255,0.03); border-left: 4px solid #ff8800; padding: 24px; border-radius: 12px; margin: 20px 0; line-height: 1.8; }
        .explanation { background: rgba(0,0,0,0.3); padding: 20px; border-radius: 12px; margin: 16px 0; border-left: 3px solid #6366f1; }
        @media (max-width: 768px) { .navbar { padding: 0 20px; } .nav-links { display: none; } .container { padding: 20px; } .timer { right: 20px; padding: 12px; font-size: 18px; } }
    
        
        /* Comprehensive Responsive Design */
        @media (max-width: 1200px) {
            .container { max-width: 100%; padding: 40px 16px; }
        }
        
        @media (max-width: 768px) {
            .navbar { padding: 0 20px; height: 60px; }
            .logo { font-size: 24px; }
            .nav-links { display: none; }
            .hamburger { display: flex; }
            
            .container { margin-top: 80px; padding: 20px 16px; }
            .page-header h1 { font-size: 32px; }
            .page-header p { font-size: 14px; }
            
            .mode-btns { gap: 8px; }
            .mode-btn { min-width: 100px; padding: 10px 16px; font-size: 13px; }
            
            .feature-grid { grid-template-columns: 1fr; gap: 16px; }
            .feature-card { padding: 20px; }
            
            .schedule-grid { grid-template-columns: 1fr; }
            .schedule-card { padding: 16px; }
            
            .quiz-card, .flashcard { padding: 24px; }
        }
        
        @media (max-width: 480px) {
            .navbar { padding: 0 16px; }
            .logo { font-size: 20px; }
            
            .container { margin-top: 70px; padding: 16px 12px; }
            .page-header h1 { font-size: 28px; }
            
            .mode-btns { flex-direction: column; }
            .mode-btn { width: 100%; min-width: auto; }
            
            .feature-card, .quiz-card, .flashcard { padding: 16px; }
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="logo" onclick="window.location.href='index.html'">TCal</div>
        <div class="nav-links">
            <a href="index.html" class="nav-link">Home</a>
            <a href="calculator-full.html" class="nav-link">Calculator</a>
            <a href="search.html" class="nav-link">Search</a>
        </div>
    </nav>

    <div class="container">
        <div class="mode-btns">
            <button class="mode-btn calc" onclick="window.location.href='calculator-full.html'">üßÆ Calculator</button>
            <button class="mode-btn search" onclick="window.location.href='search.html'">üîç Search</button>
            <button class="mode-btn">üìö Study</button>
        </div>

        <!-- Step 1: Subject Selection -->
        <div class="step active" id="step1">
            <h1>Choose Your Subject</h1>
            <p style="color: #888; margin-bottom: 10px;">Select a subject to study</p>
            <div class="grid" id="subjectGrid"></div>
        </div>

        <!-- Step 2: Topic Selection -->
        <div class="step" id="step2">
            <div class="back-btn" onclick="goToStep(1)">‚Üê Back</div>
            <h1 id="subjectTitle">Mathematics</h1>
            <p style="color: #888; margin-bottom: 10px;">Choose a topic</p>
            <div class="grid" id="topicGrid"></div>
        </div>

        <!-- Step 3: Mode Selection -->
        <div class="step" id="step3">
            <div class="back-btn" onclick="goToStep(2)">‚Üê Back</div>
            <h1>How do you want to learn?</h1>
            <div class="grid">
                <div class="card" onclick="chooseMode('study')">
                    <h2 style="font-size: 48px; margin-bottom: 16px;">üìñ</h2>
                    <h3>Study</h3>
                    <p style="color: #888; margin-top: 8px;">Learn with AI tutor</p>
                </div>
                <div class="card" onclick="chooseMode('quiz')">
                    <h2 style="font-size: 48px; margin-bottom: 16px;">üìù</h2>
                    <h3>Quiz</h3>
                    <p style="color: #888; margin-top: 8px;">Test your knowledge</p>
                </div>
            </div>
        </div>

        <!-- Step 4: Study Roadmap Choice -->
        <div class="step" id="step4">
            <div class="back-btn" onclick="goToStep(3)">‚Üê Back</div>
            <h1>Study Mode</h1>
            <p style="color: #888;">Do you want a complete learning roadmap for <span id="topicName" style="color: #ff8800;"></span>?</p>
            <div class="grid">
                <div class="card" onclick="generateRoadmap()">
                    <h2 style="font-size: 48px; margin-bottom: 16px;">üó∫Ô∏è</h2>
                    <h3>Yes, Roadmap</h3>
                    <p style="color: #888; margin-top: 8px;">Get structured path</p>
                </div>
                <div class="card" onclick="customStudy()">
                    <h2 style="font-size: 48px; margin-bottom: 16px;">‚úèÔ∏è</h2>
                    <h3>Custom Learning</h3>
                    <p style="color: #888; margin-top: 8px;">Tell me what to learn</p>
                </div>
            </div>
        </div>

        <!-- Step 5: Quiz Settings -->
        <div class="step" id="step5">
            <div class="back-btn" onclick="goToStep(3)">‚Üê Back</div>
            <h1>Quiz Settings</h1>
            <div style="max-width: 500px; margin: 30px auto;">
                <label style="display: block; margin-bottom: 8px; color: #888;">Number of Questions:</label>
                <select id="numQuestions">
                    <option value="5">5 Questions</option>
                    <option value="10" selected>10 Questions</option>
                    <option value="15">15 Questions</option>
                    <option value="20">20 Questions</option>
                </select>
                
                <label style="display: block; margin-bottom: 8px; margin-top: 20px; color: #888;">Timer:</label>
                <select id="quizTimer">
                    <option value="0">No Timer</option>
                    <option value="5">5 Minutes</option>
                    <option value="10" selected>10 Minutes</option>
                    <option value="15">15 Minutes</option>
                    <option value="20">20 Minutes</option>
                    <option value="30">30 Minutes</option>
                </select>
                
                <button class="btn" style="width: 100%;" onclick="startQuiz()">Start Quiz</button>
            </div>
        </div>

        <!-- Step 6: Study Content -->
        <div class="step" id="step6">
            <div class="back-btn" onclick="goToStep(4)">‚Üê Back</div>
            <div id="studyContent"></div>
        </div>

        <!-- Step 7: Custom Study Input -->
        <div class="step" id="step7">
            <div class="back-btn" onclick="goToStep(4)">‚Üê Back</div>
            <h1>What do you want to learn?</h1>
            <p style="color: #888; margin-bottom: 20px;">Tell me what you'd like to learn about <span id="customTopicName" style="color: #ff8800;"></span></p>
            <textarea id="customInput" placeholder="Example: I want to understand how to solve quadratic equations step by step"></textarea>
            <button class="btn" onclick="teachCustom()">Teach Me</button>
        </div>

        <!-- Step 8: Quiz -->
        <div class="step" id="step8">
            <div class="timer" id="timerDisplay" style="display: none;"></div>
            <div class="progress"><div class="progress-fill" id="quizProgress" style="width: 0%;"></div></div>
            <div id="quizContent"></div>
            <button class="btn" onclick="submitQuiz()" style="width: 100%;">Submit Quiz</button>
        </div>

        <!-- Step 9: Quiz Results -->
        <div class="step" id="step9">
            <div id="resultsContent"></div>
            <button class="btn" onclick="goToStep(1)">Take Another Quiz</button>
            <button class="btn" style="background: rgba(255,255,255,0.1); margin-left: 12px;" onclick="location.reload()">Start Over</button>
        </div>
    </div>

    <script>
        const apiKey = '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';
        let currentSubject = '';
        let currentTopic = '';
        let quizData = [];
        let userAnswers = [];
        let timerInterval = null;
        let quizHistory = JSON.parse(localStorage.getItem('quizHistory')) || [];

        const subjects = {
            'Mathematics': ['Algebra', 'Geometry', 'Trigonometry', 'Calculus', 'Statistics'],
            'Physics': ['Mechanics', 'Thermodynamics', 'Electricity', 'Waves', 'Optics'],
            'Chemistry': ['Organic', 'Inorganic', 'Physical Chemistry', 'Analytical'],
            'Biology': ['Cell Biology', 'Genetics', 'Evolution', 'Ecology'],
            'Computer Science': ['Algorithms', 'Data Structures', 'AI', 'Web Dev'],
            'Engineering': ['Mechanical', 'Electrical', 'Civil', 'Software'],
            'Economics': ['Micro', 'Macro', 'International', 'Finance'],
            'Psychology': ['Cognitive', 'Developmental', 'Social', 'Clinical']
        };

        window.addEventListener('load', init);

        function init() {
            renderSubjects();
        }

        function renderSubjects() {
            const grid = document.getElementById('subjectGrid');
            grid.innerHTML = Object.keys(subjects).map(s => `
                <div class="card" onclick="selectSubject('${s}')">
                    <h3>${s}</h3>
                </div>
            `).join('');
        }

        function selectSubject(subject) {
            currentSubject = subject;
            document.getElementById('subjectTitle').textContent = subject;
            const grid = document.getElementById('topicGrid');
            grid.innerHTML = subjects[subject].map(t => `
                <div class="card" onclick="selectTopic('${t}')">
                    <h3>${t}</h3>
                </div>
            `).join('');
            goToStep(2);
        }

        function selectTopic(topic) {
            currentTopic = topic;
            document.getElementById('topicName').textContent = topic;
            document.getElementById('customTopicName').textContent = topic;
            goToStep(3);
        }

        function chooseMode(mode) {
            if (mode === 'study') goToStep(4);
            else goToStep(5);
        }

        async function generateRoadmap() {
            goToStep(6);
            const content = document.getElementById('studyContent');
            content.innerHTML = '<p style="color: #888;">Generating roadmap...</p>';
            
            const roadmap = await callAI(`Create a comprehensive learning roadmap for ${currentTopic} in ${currentSubject}. Include:
1. Prerequisites (what to know first)
2. Core concepts (in learning order)
3. Practice problems for each concept
4. Resources and tips
5. Estimated timeline

Make it detailed and well-structured.`);
            
            content.innerHTML = `<h1>üìö ${currentTopic} Roadmap</h1><div class="roadmap">${roadmap.replace(/\n/g, '<br>')}</div>`;
        }

        function customStudy() {
            goToStep(7);
        }

        async function teachCustom() {
            const input = document.getElementById('customInput').value.trim();
            if (!input) { alert('Please enter what you want to learn!'); return; }
            
            goToStep(6);
            const content = document.getElementById('studyContent');
            content.innerHTML = '<p style="color: #888;">Teaching...</p>';
            
            const lesson = await callAI(`Teach me: ${input}

Context: ${currentTopic} in ${currentSubject}

Provide:
1. Clear explanation
2. Examples
3. Step-by-step breakdowns
4. Common mistakes to avoid
5. Practice tips

Make it detailed and easy to understand.`);
            
            content.innerHTML = `<h1>üìñ ${currentTopic} - Custom Lesson</h1><div class="roadmap">${lesson.replace(/\n/g, '<br>')}</div>`;
        }

        async function startQuiz() {
            const num = document.getElementById('numQuestions').value;
            const timer = document.getElementById('quizTimer').value;
            
            goToStep(8);
            document.getElementById('quizContent').innerHTML = '<p style="color: #888;">Generating questions...</p>';
            
            quizData = await generateQuestions(num);
            userAnswers = new Array(quizData.length).fill(null);
            displayQuiz();
            
            if (timer > 0) startTimer(timer * 60);
        }

        async function generateQuestions(num) {
            const prompt = `Generate exactly ${num} multiple choice questions about ${currentTopic} in ${currentSubject}.

Return ONLY a JSON array (no markdown, no backticks) in this exact format:
[
  {
    "question": "Question text here?",
    "options": ["Option A", "Option B", "Option C", "Option D"],
    "correct": 0,
    "explanation": "Why this answer is correct"
  }
]

Make questions challenging but fair.`;

            const response = await callAI(prompt);
            try {
                const cleaned = response.replace(/```json\n?/g, '').replace(/```\n?/g, '').trim();
                return JSON.parse(cleaned);
            } catch (e) {
                return Array(parseInt(num)).fill(null).map((_, i) => ({
                    question: `Sample question ${i + 1} about ${currentTopic}?`,
                    options: ['Option A', 'Option B', 'Option C', 'Option D'],
                    correct: 0,
                    explanation: 'This is the correct answer.'
                }));
            }
        }

        function displayQuiz() {
            const content = document.getElementById('quizContent');
            content.innerHTML = quizData.map((q, i) => `
                <div class="quiz-question">
                    <h3>Question ${i + 1} of ${quizData.length}</h3>
                    <p style="margin: 16px 0; font-size: 16px;">${q.question}</p>
                    ${q.options.map((opt, j) => `
                        <div class="quiz-option" onclick="selectAnswer(${i}, ${j})" id="q${i}opt${j}">
                            ${String.fromCharCode(65 + j)}. ${opt}
                        </div>
                    `).join('')}
                </div>
            `).join('');
        }

        function selectAnswer(qIndex, optIndex) {
            // Clear previous selection
            for (let j = 0; j < 4; j++) {
                const opt = document.getElementById(`q${qIndex}opt${j}`);
                if (opt) opt.classList.remove('selected');
            }
            // Select new
            document.getElementById(`q${qIndex}opt${optIndex}`).classList.add('selected');
            userAnswers[qIndex] = optIndex;
            updateProgress();
        }

        function updateProgress() {
            const answered = userAnswers.filter(a => a !== null).length;
            const progress = (answered / quizData.length) * 100;
            document.getElementById('quizProgress').style.width = progress + '%';
        }

        function startTimer(seconds) {
            const display = document.getElementById('timerDisplay');
            display.style.display = 'block';
            
            timerInterval = setInterval(() => {
                seconds--;
                const mins = Math.floor(seconds / 60);
                const secs = seconds % 60;
                display.textContent = `${mins}:${secs.toString().padStart(2, '0')}`;
                
                if (seconds <= 0) {
                    clearInterval(timerInterval);
                    submitQuiz();
                }
            }, 1000);
        }

        function submitQuiz() {
            if (timerInterval) clearInterval(timerInterval);
            
            let correct = 0;
            quizData.forEach((q, i) => {
                if (userAnswers[i] === q.correct) correct++;
            });
            
            const score = (correct / quizData.length) * 100;
            quizHistory.push({ subject: currentSubject, topic: currentTopic, score, date: new Date().toISOString() });
            localStorage.setItem('quizHistory', JSON.stringify(quizHistory));
            
            const average = quizHistory.reduce((sum, q) => sum + q.score, 0) / quizHistory.length;
            
            displayResults(score, average, correct);
            goToStep(9);
        }

        function displayResults(score, average, correct) {
            const content = document.getElementById('resultsContent');
            content.innerHTML = `
                <h1>üéâ Quiz Complete!</h1>
                <div class="score-card">
                    <h2>${score.toFixed(1)}%</h2>
                    <p style="font-size: 18px; color: #888;">You got ${correct} out of ${quizData.length} correct</p>
                    <p style="font-size: 16px; color: #888; margin-top: 12px;">Your average: ${average.toFixed(1)}%</p>
                </div>
                
                <h2 style="margin-top: 40px; margin-bottom: 20px;">Review Your Answers:</h2>
                ${quizData.map((q, i) => {
                    const isCorrect = userAnswers[i] === q.correct;
                    const userAns = userAnswers[i];
                    return `
                        <div class="quiz-question" style="border-left: 4px solid ${isCorrect ? '#00ff88' : '#ff6666'};">
                            <h3>${isCorrect ? '‚úÖ' : '‚ùå'} Question ${i + 1}</h3>
                            <p style="margin: 16px 0;">${q.question}</p>
                            ${q.options.map((opt, j) => `
                                <div class="quiz-option ${j === q.correct ? 'correct' : ''} ${j === userAns && !isCorrect ? 'wrong' : ''}">
                                    ${String.fromCharCode(65 + j)}. ${opt}
                                    ${j === q.correct ? ' ‚úì' : ''}
                                </div>
                            `).join('')}
                            ${!isCorrect ? `
                                <div class="explanation">
                                    <strong>Explanation:</strong><br>${q.explanation}
                                    <button class="btn" style="margin-top: 12px; padding: 8px 16px; font-size: 13px;" onclick="retryQuestion(${i})">Retry This Question</button>
                                </div>
                            ` : ''}
                        </div>
                    `;
                }).join('')}
            `;
        }

        async function retryQuestion(index) {
            const q = quizData[index];
            const explain = await callAI(`Explain this concept in detail so I can understand and answer correctly:

Question: ${q.question}
Correct Answer: ${q.options[q.correct]}

Provide:
1. Detailed explanation
2. Key concept
3. How to approach similar questions`);
            
            alert(explain);
        }

        async function callAI(prompt) {
            const response = await fetch("https://api.groq.com/openai/v1/chat/completions", {
                method: "POST",
                headers: { 
                    "Content-Type": "application/json",
                    "Authorization": `Bearer ${apiKey}`
                },
                body: JSON.stringify({
                    model: "llama-3.3-70b-versatile",
                    messages: [{ role: "user", content: prompt }],
                    temperature: 0.7,
                    max_tokens: 3000
                })
            });
            const data = await response.json();
            return data.choices[0].message.content;
        }

        function goToStep(step) {
            document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
            document.getElementById('step' + step).classList.add('active');
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
    </script>
</body>
</html>
